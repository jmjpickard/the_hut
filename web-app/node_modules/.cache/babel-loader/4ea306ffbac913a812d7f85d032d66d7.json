{"ast":null,"code":"import React, { createContext, useContext, useRef, useEffect, useCallback } from 'react';\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nvar Types;\n\n(function (Types) {\n  Types[\"SHOW\"] = \"SHOW\";\n  Types[\"HIDE\"] = \"HIDE\";\n  Types[\"UPDATE\"] = \"UPDATE\";\n  Types[\"DESTROY\"] = \"DESTROY\";\n  Types[\"DESTROY_BY_ROOT_ID\"] = \"DESTROY_BY_ROOT_ID\";\n  Types[\"UNKNOWN\"] = \"UNKNOWN\";\n})(Types || (Types = {}));\n\nvar initialState = {};\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case Types.SHOW:\n      {\n        var _extends2;\n\n        var _action$payload = action.payload,\n            id = _action$payload.id,\n            component = _action$payload.component,\n            props = _action$payload.props,\n            options = _action$payload.options;\n        return _extends({}, state, (_extends2 = {}, _extends2[id] = {\n          component: component,\n          props: _extends({}, props, {\n            open: true\n          }),\n          options: options\n        }, _extends2));\n      }\n\n    case Types.HIDE:\n      {\n        var _extends3;\n\n        var _id = action.payload.id;\n\n        if (!state[_id]) {\n          return state;\n        }\n\n        return _extends({}, state, (_extends3 = {}, _extends3[_id] = _extends({}, state[_id], {\n          props: _extends({}, state[_id].props, {\n            open: false\n          })\n        }), _extends3));\n      }\n\n    case Types.UPDATE:\n      {\n        var _extends4;\n\n        var _action$payload2 = action.payload,\n            _id2 = _action$payload2.id,\n            _props = _action$payload2.props;\n\n        if (!state[_id2]) {\n          return state;\n        }\n\n        return _extends({}, state, (_extends4 = {}, _extends4[_id2] = _extends({}, state[_id2], {\n          props: _extends({}, state[_id2].props, _props)\n        }), _extends4));\n      }\n\n    case Types.DESTROY:\n      {\n        var _id3 = action.payload.id;\n\n        var newState = _extends({}, state);\n\n        delete newState[_id3];\n        return newState;\n      }\n\n    case Types.DESTROY_BY_ROOT_ID:\n      {\n        var rootId = action.payload.rootId;\n        return Object.keys(state).filter(function (key) {\n          return key.split('.')[0] !== rootId;\n        }).reduce(function (acc, key) {\n          var _extends5;\n\n          return _extends({}, acc, (_extends5 = {}, _extends5[key] = state[key], _extends5));\n        }, {});\n      }\n\n    default:\n      throw new Error('Unexpected action');\n  }\n}\n\nvar initialContextState = {\n  state: initialState,\n  hideModal: function hideModal() {},\n  showModal: function showModal() {\n    return {\n      id: 'id',\n      hide: function hide() {},\n      destroy: function destroy() {},\n      update: function update() {}\n    };\n  },\n  destroyModal: function destroyModal() {},\n  updateModal: function updateModal() {},\n  destroyModalsByRootId: function destroyModalsByRootId() {}\n};\nvar ModalContext = /*#__PURE__*/createContext(initialContextState);\nvar MISSED_MODAL_ID_ERROR_MESSAGE = '[ERROR]: Modal ID is missing';\nvar MISSED_MODAL_ROOT_ID_ERROR_MESSAGE = '[ERROR]: Modal root ID is missing';\n\nvar uid = function uid(len) {\n  if (len === void 0) {\n    len = 8;\n  }\n\n  var buf = [];\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  var charlen = chars.length;\n\n  for (var i = 0; i < len; i++) {\n    buf[i] = chars.charAt(Math.floor(Math.random() * charlen));\n  }\n\n  return buf.join('');\n};\n\nfunction ModalProvider(_ref) {\n  var children = _ref.children,\n      _ref$legacy = _ref.legacy,\n      legacy = _ref$legacy === void 0 ? false : _ref$legacy;\n\n  var _React$useReducer = React.useReducer(reducer, initialState),\n      state = _React$useReducer[0],\n      dispatch = _React$useReducer[1];\n\n  var _update = React.useCallback(function (id, _ref2) {\n    var props = _objectWithoutPropertiesLoose(_ref2, [\"open\"]);\n\n    if (!id) {\n      console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\n      return;\n    }\n\n    dispatch({\n      type: Types.UPDATE,\n      payload: {\n        id: id,\n        props: props\n      }\n    });\n  }, [dispatch]);\n\n  var _hide = React.useCallback(function (id) {\n    if (!id) {\n      console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\n      return;\n    }\n\n    dispatch({\n      type: Types.HIDE,\n      payload: {\n        id: id\n      }\n    });\n  }, [dispatch]);\n\n  var _destroy = React.useCallback(function (id) {\n    if (!id) {\n      console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\n      return;\n    }\n\n    dispatch({\n      type: Types.DESTROY,\n      payload: {\n        id: id\n      }\n    });\n  }, [dispatch]);\n\n  var destroyByRootId = React.useCallback(function (rootId) {\n    if (!rootId) {\n      console.error(MISSED_MODAL_ROOT_ID_ERROR_MESSAGE);\n      return;\n    }\n\n    dispatch({\n      type: Types.DESTROY_BY_ROOT_ID,\n      payload: {\n        rootId: rootId\n      }\n    });\n  }, [dispatch]);\n  var show = React.useCallback(function (component, props, options) {\n    var id = uid(8);\n\n    if (options && options.rootId) {\n      id = options.rootId + \".\" + id;\n    }\n\n    dispatch({\n      type: Types.SHOW,\n      payload: {\n        id: id,\n        component: component,\n        props: props,\n        options: options\n      }\n    });\n    return {\n      id: id,\n      hide: function hide() {\n        return _hide(id);\n      },\n      destroy: function destroy() {\n        return _destroy(id);\n      },\n      update: function update(newProps) {\n        return _update(id, newProps);\n      }\n    };\n  }, [dispatch, _hide, _destroy, _update]);\n\n  var renderState = function renderState() {\n    return Object.keys(state).map(function (id) {\n      var _state$id = state[id],\n          Component = _state$id.component,\n          props = _state$id.props,\n          options = _state$id.options;\n\n      var handleClose = function handleClose() {\n        if (options && options.destroyOnClose) {\n          _destroy(id);\n        } else {\n          _hide(id);\n        }\n\n        if (props && props.onClose) {\n          props.onClose.apply(props, arguments);\n        }\n      };\n\n      var handleExited = function handleExited() {\n        var _props$TransitionProp;\n\n        if (props === null || props === void 0 ? void 0 : props.onExited) {\n          props.onExited.apply(props, arguments);\n        }\n\n        if (props === null || props === void 0 ? void 0 : (_props$TransitionProp = props.TransitionProps) === null || _props$TransitionProp === void 0 ? void 0 : _props$TransitionProp.onExited) {\n          var _props$TransitionProp2;\n\n          (_props$TransitionProp2 = props.TransitionProps).onExited.apply(_props$TransitionProp2, arguments);\n        }\n\n        _destroy(id);\n      };\n\n      var extraProps = {};\n\n      if (!legacy) {\n        extraProps = {\n          TransitionProps: _extends({}, props === null || props === void 0 ? void 0 : props.TransitionProps, {\n            onExited: handleExited\n          })\n        };\n      } else {\n        extraProps = {\n          onExited: handleExited\n        };\n      }\n\n      return React.createElement(Component, Object.assign({}, props, {\n        key: id,\n        onClose: handleClose\n      }, options && !options.destroyOnClose && extraProps));\n    });\n  };\n\n  return React.createElement(ModalContext.Provider, {\n    value: {\n      state: state,\n      updateModal: _update,\n      hideModal: _hide,\n      destroyModal: _destroy,\n      showModal: show,\n      destroyModalsByRootId: destroyByRootId\n    }\n  }, children, renderState());\n}\n\nvar defaultOptions = {\n  disableAutoDestroy: false\n};\n\nfunction useModal(options) {\n  if (options === void 0) {\n    options = defaultOptions;\n  }\n\n  var _defaultOptions$optio = _extends({}, defaultOptions, options),\n      disableAutoDestroy = _defaultOptions$optio.disableAutoDestroy;\n\n  var _useContext = useContext(ModalContext),\n      showModal = _useContext.showModal,\n      destroy = _useContext.destroyModalsByRootId,\n      otherContextProps = _objectWithoutPropertiesLoose(_useContext, [\"showModal\", \"destroyModalsByRootId\"]);\n\n  var id = useRef(uid(6));\n  useEffect(function () {\n    return function () {\n      if (!disableAutoDestroy) {\n        destroy(id.current);\n      }\n    };\n  }, [disableAutoDestroy, destroy]);\n  return _extends({\n    showModal: useCallback(function (component, props, options) {\n      return showModal(component, props, _extends({\n        rootId: id.current\n      }, options));\n    }, [showModal])\n  }, otherContextProps);\n}\n\nexport default ModalProvider;\nexport { useModal };","map":{"version":3,"sources":["../src/reducer.ts","../src/ModalContext.ts","../src/constants.ts","../src/utils.ts","../src/ModalProvider.tsx","../src/useModal.ts"],"names":["Types","initialState","reducer","state","action","id","component","props","options","open","newState","rootId","key","initialContextState","hideModal","showModal","hide","destroy","update","destroyModal","updateModal","destroyModalsByRootId","ModalContext","createContext","MISSED_MODAL_ID_ERROR_MESSAGE","MISSED_MODAL_ROOT_ID_ERROR_MESSAGE","uid","len","buf","chars","charlen","i","Math","ModalProvider","children","legacy","dispatch","React","console","type","payload","destroyByRootId","show","renderState","Component","handleClose","handleExited","extraProps","TransitionProps","onExited","onClose","value","defaultOptions","disableAutoDestroy","useModal","otherContextProps","useContext","useRef","useEffect","useCallback","current"],"mappings":"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","sourcesContent":["import {\r\n  State,\r\n  StateElement,\r\n  ActionMap,\r\n  ModalComponentProps,\r\n  Props,\r\n} from './types';\r\n\r\nexport enum Types {\r\n  SHOW = 'SHOW',\r\n  HIDE = 'HIDE',\r\n  UPDATE = 'UPDATE',\r\n  DESTROY = 'DESTROY',\r\n  DESTROY_BY_ROOT_ID = 'DESTROY_BY_ROOT_ID',\r\n  UNKNOWN = 'UNKNOWN',\r\n}\r\n\r\ntype Payload = {\r\n  [Types.SHOW]: StateElement & {\r\n    id: string;\r\n  };\r\n  [Types.HIDE]: {\r\n    id: string;\r\n  };\r\n  [Types.UPDATE]: {\r\n    id: string;\r\n    props: ModalComponentProps<Props>;\r\n  };\r\n  [Types.DESTROY]: {\r\n    id: string;\r\n  };\r\n  [Types.DESTROY_BY_ROOT_ID]: {\r\n    rootId: string;\r\n  };\r\n  [Types.UNKNOWN]: undefined;\r\n};\r\n\r\ntype Action = ActionMap<Payload>[keyof ActionMap<Payload>];\r\n\r\nexport const initialState: State = {};\r\n\r\nexport default function reducer(state: State, action: Action) {\r\n  switch (action.type) {\r\n    case Types.SHOW: {\r\n      const { id, component, props, options } = action.payload;\r\n\r\n      return {\r\n        ...state,\r\n        [id]: {\r\n          component,\r\n          props: {\r\n            ...props,\r\n            open: true,\r\n          },\r\n          options,\r\n        },\r\n      };\r\n    }\r\n    case Types.HIDE: {\r\n      const { id } = action.payload;\r\n\r\n      if (!state[id]) {\r\n        return state;\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        [id]: {\r\n          ...state[id],\r\n          props: {\r\n            ...state[id].props,\r\n            open: false,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case Types.UPDATE: {\r\n      const { id, props } = action.payload;\r\n\r\n      if (!state[id]) {\r\n        return state;\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        [id]: {\r\n          ...state[id],\r\n          props: {\r\n            ...state[id].props,\r\n            ...props,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case Types.DESTROY: {\r\n      const { id } = action.payload;\r\n      const newState = { ...state };\r\n      delete newState[id];\r\n      return newState;\r\n    }\r\n    case Types.DESTROY_BY_ROOT_ID: {\r\n      const { rootId } = action.payload;\r\n\r\n      return Object.keys(state)\r\n        .filter(key => key.split('.')[0] !== rootId)\r\n        .reduce<State>(\r\n          (acc, key) => ({\r\n            ...acc,\r\n            [key]: state[key],\r\n          }),\r\n          {}\r\n        );\r\n    }\r\n    default:\r\n      throw new Error('Unexpected action');\r\n  }\r\n}\r\n","import { createContext } from 'react';\r\nimport { initialState } from './reducer';\r\nimport {\r\n  State,\r\n  HideFn,\r\n  ShowFn,\r\n  DestroyFn,\r\n  DestroyByRootIdFn,\r\n  UpdateFn,\r\n} from './types';\r\n\r\nexport type ModalContextState = {\r\n  state: State;\r\n  updateModal: UpdateFn;\r\n  hideModal: HideFn;\r\n  destroyModal: DestroyFn;\r\n  destroyModalsByRootId: DestroyByRootIdFn;\r\n  showModal: ShowFn;\r\n};\r\n\r\nexport const initialContextState = {\r\n  state: initialState,\r\n  hideModal: () => {},\r\n  showModal: () => ({\r\n    id: 'id',\r\n    hide: () => {},\r\n    destroy: () => {},\r\n    update: () => {},\r\n  }),\r\n  destroyModal: () => {},\r\n  updateModal: () => {},\r\n  destroyModalsByRootId: () => {},\r\n};\r\n\r\nconst ModalContext = createContext<ModalContextState>(initialContextState);\r\n\r\nexport default ModalContext;\r\n","export const MISSED_MODAL_ID_ERROR_MESSAGE = '[ERROR]: Modal ID is missing';\r\nexport const MISSED_MODAL_ROOT_ID_ERROR_MESSAGE =\r\n  '[ERROR]: Modal root ID is missing';\r\n","export const uid = (len: number = 8): string => {\r\n  const buf: string[] = [];\r\n  const chars =\r\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  const charlen = chars.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    buf[i] = chars.charAt(Math.floor(Math.random() * charlen));\r\n  }\r\n\r\n  return buf.join('');\r\n};\r\n","import React from 'react';\r\nimport ModalContext from './ModalContext';\r\nimport reducer, { initialState, Types } from './reducer';\r\nimport {\r\n  DestroyByRootIdFn,\r\n  DestroyFn,\r\n  HideFn,\r\n  ShowFn,\r\n  UpdateFn,\r\n} from './types';\r\nimport {\r\n  MISSED_MODAL_ID_ERROR_MESSAGE,\r\n  MISSED_MODAL_ROOT_ID_ERROR_MESSAGE,\r\n} from './constants';\r\nimport { uid } from './utils';\r\n\r\ntype Props = {\r\n  children: React.ReactNode;\r\n  /**\r\n   * Enable it if you want to use mui < 5 version\r\n   */\r\n  legacy?: boolean;\r\n};\r\n\r\nexport default function ModalProvider({ children, legacy = false }: Props) {\r\n  const [state, dispatch] = React.useReducer(reducer, initialState);\r\n\r\n  const update = React.useCallback<UpdateFn>(\r\n    (id, { open, ...props }) => {\r\n      if (!id) {\r\n        console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.UPDATE,\r\n        payload: {\r\n          id,\r\n          props,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const hide = React.useCallback<HideFn>(\r\n    id => {\r\n      if (!id) {\r\n        console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.HIDE,\r\n        payload: {\r\n          id,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const destroy = React.useCallback<DestroyFn>(\r\n    id => {\r\n      if (!id) {\r\n        console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.DESTROY,\r\n        payload: {\r\n          id,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const destroyByRootId = React.useCallback<DestroyByRootIdFn>(\r\n    rootId => {\r\n      if (!rootId) {\r\n        console.error(MISSED_MODAL_ROOT_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.DESTROY_BY_ROOT_ID,\r\n        payload: {\r\n          rootId,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const show = React.useCallback<ShowFn>(\r\n    (component, props, options) => {\r\n      let id = uid(8);\r\n\r\n      if (options && options.rootId) {\r\n        id = `${options.rootId}.${id}`;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.SHOW,\r\n        payload: {\r\n          id,\r\n          component,\r\n          props,\r\n          options,\r\n        },\r\n      });\r\n\r\n      return {\r\n        id,\r\n        hide: () => hide(id),\r\n        destroy: () => destroy(id),\r\n        update: newProps => update(id, newProps),\r\n      };\r\n    },\r\n    [dispatch, hide, destroy, update]\r\n  );\r\n\r\n  const renderState = () =>\r\n    Object.keys(state).map(id => {\r\n      const { component: Component, props, options } = state[id];\r\n\r\n      const handleClose = (...args: any[]) => {\r\n        if (options && options.destroyOnClose) {\r\n          destroy(id);\r\n        } else {\r\n          hide(id);\r\n        }\r\n\r\n        if (props && props.onClose) {\r\n          props.onClose(...args);\r\n        }\r\n      };\r\n\r\n      const handleExited = (...args: any[]) => {\r\n        if (props?.onExited) {\r\n          props.onExited(...args);\r\n        }\r\n\r\n        if (props?.TransitionProps?.onExited) {\r\n          props.TransitionProps.onExited(...args);\r\n        }\r\n\r\n        destroy(id);\r\n      };\r\n\r\n      let extraProps = {};\r\n\r\n      if (!legacy) {\r\n        extraProps = {\r\n          TransitionProps: {\r\n            ...props?.TransitionProps,\r\n            onExited: handleExited,\r\n          },\r\n        };\r\n      } else {\r\n        extraProps = {\r\n          onExited: handleExited,\r\n        };\r\n      }\r\n\r\n      return (\r\n        <Component\r\n          {...props}\r\n          key={id}\r\n          onClose={handleClose}\r\n          {...(options && !options.destroyOnClose && extraProps)}\r\n        />\r\n      );\r\n    });\r\n\r\n  return (\r\n    <ModalContext.Provider\r\n      value={{\r\n        state,\r\n        updateModal: update,\r\n        hideModal: hide,\r\n        destroyModal: destroy,\r\n        showModal: show,\r\n        destroyModalsByRootId: destroyByRootId,\r\n      }}\r\n    >\r\n      {children}\r\n      {renderState()}\r\n    </ModalContext.Provider>\r\n  );\r\n}\r\n","import { useContext, useCallback, useEffect, useRef } from 'react';\r\nimport { ShowFn } from './types';\r\n\r\nimport ModalContext from './ModalContext';\r\nimport { uid } from './utils';\r\n\r\ntype Options = {\r\n  disableAutoDestroy?: boolean;\r\n};\r\n\r\nconst defaultOptions: Options = {\r\n  disableAutoDestroy: false,\r\n};\r\n\r\nexport default function useModal(options: Options = defaultOptions) {\r\n  const { disableAutoDestroy } = { ...defaultOptions, ...options };\r\n  const {\r\n    showModal,\r\n    destroyModalsByRootId: destroy,\r\n    ...otherContextProps\r\n  } = useContext(ModalContext);\r\n  const id = useRef<string>(uid(6));\r\n\r\n  useEffect(\r\n    () => () => {\r\n      if (!disableAutoDestroy) {\r\n        destroy(id.current);\r\n      }\r\n    },\r\n    [disableAutoDestroy, destroy]\r\n  );\r\n\r\n  return {\r\n    showModal: useCallback<ShowFn>(\r\n      (component, props, options) =>\r\n        showModal(component, props, { rootId: id.current, ...options }),\r\n      [showModal]\r\n    ),\r\n    ...otherContextProps,\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}