{"version":3,"file":"mui-modal-provider.cjs.production.min.js","sources":["../src/reducer.ts","../src/ModalContext.ts","../src/utils.ts","../src/useModal.ts","../src/ModalProvider.tsx","../src/constants.ts"],"sourcesContent":["import {\r\n  State,\r\n  StateElement,\r\n  ActionMap,\r\n  ModalComponentProps,\r\n  Props,\r\n} from './types';\r\n\r\nexport enum Types {\r\n  SHOW = 'SHOW',\r\n  HIDE = 'HIDE',\r\n  UPDATE = 'UPDATE',\r\n  DESTROY = 'DESTROY',\r\n  DESTROY_BY_ROOT_ID = 'DESTROY_BY_ROOT_ID',\r\n  UNKNOWN = 'UNKNOWN',\r\n}\r\n\r\ntype Payload = {\r\n  [Types.SHOW]: StateElement & {\r\n    id: string;\r\n  };\r\n  [Types.HIDE]: {\r\n    id: string;\r\n  };\r\n  [Types.UPDATE]: {\r\n    id: string;\r\n    props: ModalComponentProps<Props>;\r\n  };\r\n  [Types.DESTROY]: {\r\n    id: string;\r\n  };\r\n  [Types.DESTROY_BY_ROOT_ID]: {\r\n    rootId: string;\r\n  };\r\n  [Types.UNKNOWN]: undefined;\r\n};\r\n\r\ntype Action = ActionMap<Payload>[keyof ActionMap<Payload>];\r\n\r\nexport const initialState: State = {};\r\n\r\nexport default function reducer(state: State, action: Action) {\r\n  switch (action.type) {\r\n    case Types.SHOW: {\r\n      const { id, component, props, options } = action.payload;\r\n\r\n      return {\r\n        ...state,\r\n        [id]: {\r\n          component,\r\n          props: {\r\n            ...props,\r\n            open: true,\r\n          },\r\n          options,\r\n        },\r\n      };\r\n    }\r\n    case Types.HIDE: {\r\n      const { id } = action.payload;\r\n\r\n      if (!state[id]) {\r\n        return state;\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        [id]: {\r\n          ...state[id],\r\n          props: {\r\n            ...state[id].props,\r\n            open: false,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case Types.UPDATE: {\r\n      const { id, props } = action.payload;\r\n\r\n      if (!state[id]) {\r\n        return state;\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        [id]: {\r\n          ...state[id],\r\n          props: {\r\n            ...state[id].props,\r\n            ...props,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case Types.DESTROY: {\r\n      const { id } = action.payload;\r\n      const newState = { ...state };\r\n      delete newState[id];\r\n      return newState;\r\n    }\r\n    case Types.DESTROY_BY_ROOT_ID: {\r\n      const { rootId } = action.payload;\r\n\r\n      return Object.keys(state)\r\n        .filter(key => key.split('.')[0] !== rootId)\r\n        .reduce<State>(\r\n          (acc, key) => ({\r\n            ...acc,\r\n            [key]: state[key],\r\n          }),\r\n          {}\r\n        );\r\n    }\r\n    default:\r\n      throw new Error('Unexpected action');\r\n  }\r\n}\r\n","import { createContext } from 'react';\r\nimport { initialState } from './reducer';\r\nimport {\r\n  State,\r\n  HideFn,\r\n  ShowFn,\r\n  DestroyFn,\r\n  DestroyByRootIdFn,\r\n  UpdateFn,\r\n} from './types';\r\n\r\nexport type ModalContextState = {\r\n  state: State;\r\n  updateModal: UpdateFn;\r\n  hideModal: HideFn;\r\n  destroyModal: DestroyFn;\r\n  destroyModalsByRootId: DestroyByRootIdFn;\r\n  showModal: ShowFn;\r\n};\r\n\r\nexport const initialContextState = {\r\n  state: initialState,\r\n  hideModal: () => {},\r\n  showModal: () => ({\r\n    id: 'id',\r\n    hide: () => {},\r\n    destroy: () => {},\r\n    update: () => {},\r\n  }),\r\n  destroyModal: () => {},\r\n  updateModal: () => {},\r\n  destroyModalsByRootId: () => {},\r\n};\r\n\r\nconst ModalContext = createContext<ModalContextState>(initialContextState);\r\n\r\nexport default ModalContext;\r\n","export const uid = (len: number = 8): string => {\r\n  const buf: string[] = [];\r\n  const chars =\r\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  const charlen = chars.length;\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    buf[i] = chars.charAt(Math.floor(Math.random() * charlen));\r\n  }\r\n\r\n  return buf.join('');\r\n};\r\n","import { useContext, useCallback, useEffect, useRef } from 'react';\r\nimport { ShowFn } from './types';\r\n\r\nimport ModalContext from './ModalContext';\r\nimport { uid } from './utils';\r\n\r\ntype Options = {\r\n  disableAutoDestroy?: boolean;\r\n};\r\n\r\nconst defaultOptions: Options = {\r\n  disableAutoDestroy: false,\r\n};\r\n\r\nexport default function useModal(options: Options = defaultOptions) {\r\n  const { disableAutoDestroy } = { ...defaultOptions, ...options };\r\n  const {\r\n    showModal,\r\n    destroyModalsByRootId: destroy,\r\n    ...otherContextProps\r\n  } = useContext(ModalContext);\r\n  const id = useRef<string>(uid(6));\r\n\r\n  useEffect(\r\n    () => () => {\r\n      if (!disableAutoDestroy) {\r\n        destroy(id.current);\r\n      }\r\n    },\r\n    [disableAutoDestroy, destroy]\r\n  );\r\n\r\n  return {\r\n    showModal: useCallback<ShowFn>(\r\n      (component, props, options) =>\r\n        showModal(component, props, { rootId: id.current, ...options }),\r\n      [showModal]\r\n    ),\r\n    ...otherContextProps,\r\n  };\r\n}\r\n","import React from 'react';\r\nimport ModalContext from './ModalContext';\r\nimport reducer, { initialState, Types } from './reducer';\r\nimport {\r\n  DestroyByRootIdFn,\r\n  DestroyFn,\r\n  HideFn,\r\n  ShowFn,\r\n  UpdateFn,\r\n} from './types';\r\nimport {\r\n  MISSED_MODAL_ID_ERROR_MESSAGE,\r\n  MISSED_MODAL_ROOT_ID_ERROR_MESSAGE,\r\n} from './constants';\r\nimport { uid } from './utils';\r\n\r\ntype Props = {\r\n  children: React.ReactNode;\r\n  /**\r\n   * Enable it if you want to use mui < 5 version\r\n   */\r\n  legacy?: boolean;\r\n};\r\n\r\nexport default function ModalProvider({ children, legacy = false }: Props) {\r\n  const [state, dispatch] = React.useReducer(reducer, initialState);\r\n\r\n  const update = React.useCallback<UpdateFn>(\r\n    (id, { open, ...props }) => {\r\n      if (!id) {\r\n        console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.UPDATE,\r\n        payload: {\r\n          id,\r\n          props,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const hide = React.useCallback<HideFn>(\r\n    id => {\r\n      if (!id) {\r\n        console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.HIDE,\r\n        payload: {\r\n          id,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const destroy = React.useCallback<DestroyFn>(\r\n    id => {\r\n      if (!id) {\r\n        console.error(MISSED_MODAL_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.DESTROY,\r\n        payload: {\r\n          id,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const destroyByRootId = React.useCallback<DestroyByRootIdFn>(\r\n    rootId => {\r\n      if (!rootId) {\r\n        console.error(MISSED_MODAL_ROOT_ID_ERROR_MESSAGE);\r\n        return;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.DESTROY_BY_ROOT_ID,\r\n        payload: {\r\n          rootId,\r\n        },\r\n      });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const show = React.useCallback<ShowFn>(\r\n    (component, props, options) => {\r\n      let id = uid(8);\r\n\r\n      if (options && options.rootId) {\r\n        id = `${options.rootId}.${id}`;\r\n      }\r\n\r\n      dispatch({\r\n        type: Types.SHOW,\r\n        payload: {\r\n          id,\r\n          component,\r\n          props,\r\n          options,\r\n        },\r\n      });\r\n\r\n      return {\r\n        id,\r\n        hide: () => hide(id),\r\n        destroy: () => destroy(id),\r\n        update: newProps => update(id, newProps),\r\n      };\r\n    },\r\n    [dispatch, hide, destroy, update]\r\n  );\r\n\r\n  const renderState = () =>\r\n    Object.keys(state).map(id => {\r\n      const { component: Component, props, options } = state[id];\r\n\r\n      const handleClose = (...args: any[]) => {\r\n        if (options && options.destroyOnClose) {\r\n          destroy(id);\r\n        } else {\r\n          hide(id);\r\n        }\r\n\r\n        if (props && props.onClose) {\r\n          props.onClose(...args);\r\n        }\r\n      };\r\n\r\n      const handleExited = (...args: any[]) => {\r\n        if (props?.onExited) {\r\n          props.onExited(...args);\r\n        }\r\n\r\n        if (props?.TransitionProps?.onExited) {\r\n          props.TransitionProps.onExited(...args);\r\n        }\r\n\r\n        destroy(id);\r\n      };\r\n\r\n      let extraProps = {};\r\n\r\n      if (!legacy) {\r\n        extraProps = {\r\n          TransitionProps: {\r\n            ...props?.TransitionProps,\r\n            onExited: handleExited,\r\n          },\r\n        };\r\n      } else {\r\n        extraProps = {\r\n          onExited: handleExited,\r\n        };\r\n      }\r\n\r\n      return (\r\n        <Component\r\n          {...props}\r\n          key={id}\r\n          onClose={handleClose}\r\n          {...(options && !options.destroyOnClose && extraProps)}\r\n        />\r\n      );\r\n    });\r\n\r\n  return (\r\n    <ModalContext.Provider\r\n      value={{\r\n        state,\r\n        updateModal: update,\r\n        hideModal: hide,\r\n        destroyModal: destroy,\r\n        showModal: show,\r\n        destroyModalsByRootId: destroyByRootId,\r\n      }}\r\n    >\r\n      {children}\r\n      {renderState()}\r\n    </ModalContext.Provider>\r\n  );\r\n}\r\n","export const MISSED_MODAL_ID_ERROR_MESSAGE = '[ERROR]: Modal ID is missing';\r\nexport const MISSED_MODAL_ROOT_ID_ERROR_MESSAGE =\r\n  '[ERROR]: Modal root ID is missing';\r\n"],"names":["Types","initialState","reducer","state","action","type","SHOW","payload","options","id","component","props","open","HIDE","UPDATE","DESTROY","newState","DESTROY_BY_ROOT_ID","rootId","Object","keys","filter","key","split","reduce","acc","Error","ModalContext","createContext","hideModal","showModal","hide","destroy","update","destroyModal","updateModal","destroyModalsByRootId","uid","len","buf","chars","charlen","length","i","charAt","Math","floor","random","join","defaultOptions","disableAutoDestroy","children","legacy","React","useReducer","dispatch","useCallback","console","error","destroyByRootId","show","newProps","Provider","value","map","extraProps","Component","handleExited","onExited","TransitionProps","_props$TransitionProp","onClose","destroyOnClose","useContext","otherContextProps","useRef","useEffect","current"],"mappings":"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"}